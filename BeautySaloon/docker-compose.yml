version: '1.0'

volumes:
    beautysaloonsqldata:
    identitysqldata:
    healthcheckssqldata:

networks:
    beautysaloon-network:
        external: true

services:
    beautysaloondata:
        container_name: BeautysaloonSQLServer
        image: mcr.microsoft.com/mssql/server:2019-latest
        ports:
            - "1433:1433"
        environment:
            - ACCEPT_EULA=Y
            - SA_PASSWORD=BeautysaloonSQLServer123
        volumes:
            - beautysaloonsqldata:/var/opt/mssql
        networks:
            - beautysaloon-network

    identitydata:
        container_name: BeautysaloonIdentitySQLServer
        image: mcr.microsoft.com/mssql/server:2019-latest
        ports:
            - "1133:1433"
        environment:
            - ACCEPT_EULA=Y
            - SA_PASSWORD=BeautysaloonIdentitySQLServer123
        volumes:
            - identitysqldata:/var/opt/mssql
        networks:
            - beautysaloon-network

    healthchecksdata:
        container_name: BeautysaloonHealthChecksSQLServer
        image: mcr.microsoft.com/mssql/server:2019-latest
        ports:
            - "1533:1433"
        environment:
            - ACCEPT_EULA=Y
            - SA_PASSWORD=BeautysaloonHealthChecksSQLServer123
        volumes:
            - healthcheckssqldata:/var/opt/mssql
        networks:
            - beautysaloon-network

    identity:
        container_name: beautysaloon-identity
        image: beautysaloon-identity-service:1.24
        build:
            dockerfile: ./BeautySaloon.Identity/Dockerfile
        ports:
            - "5010:80"
            - "5001:443"
        environment:
            - ASPNETCORE_URLS=https://+:443;http://+:80
            - ASPNETCORE_Kestrel__Certificates__Default__Password=DoctorHouse2001
            - ASPNETCORE_Kestrel__Certificates__Default__Path=/app/certs/aspnetapp.pfx
            - ConnectionStrings__BeautysaloonIdentityDbConnection=Server=BeautysaloonIdentitySQLServer;Initial Catalog=BeautySaloonDb; MultipleActiveResultSets=True; TrustServerCertificate=true; User Id = sa; Password = BeautysaloonIdentitySQLServer123;
        restart: on-failure
        networks:
            - beautysaloon-network
        depends_on:
            - identitydata
        volumes:
            - ./certs:/app/certs:ro

    beautysaloon:
        container_name: beautysaloon
        image: beautysaloon-service:1.34
        build:
            dockerfile: ./BeautySaloon.API/Dockerfile
        ports:
            - "5002:80"
        environment:
            - ConnectionStrings__BeautysaloonDbConnection=Server=BeautysaloonSQLServer;Initial Catalog=BeautySaloonDb; MultipleActiveResultSets=True; TrustServerCertificate=true; User Id = sa; Password = BeautysaloonSQLServer123;
        restart: on-failure
        networks:
            - beautysaloon-network
        depends_on:
            - beautysaloondata

    healthchecks:
        container_name: healthchecks
        image: beautysaloon-service:1.64
        build:
            dockerfile: ./BeautySaloon.HealthChecksUI/Dockerfile
        ports:
            - "5003:80"
        environment:
            - ConnectionStrings__HealthChecksDb=Server=BeautysaloonHealthChecksSQLServer;Initial Catalog=BeautySaloonDb; MultipleActiveResultSets=True; TrustServerCertificate=true; User Id = sa; Password = BeautysaloonHealthChecksSQLServer123;
        restart: on-failure
        networks:
            - beautysaloon-network
        depends_on:
            - healthchecksdata
            - identity
